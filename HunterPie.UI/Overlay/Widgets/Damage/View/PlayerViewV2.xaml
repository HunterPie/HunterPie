<UserControl x:Class="HunterPie.UI.Overlay.Widgets.Damage.View.PlayerViewV2"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:arithmetics="clr-namespace:HunterPie.UI.Architecture.Converters.Arithmetics"
             xmlns:brushes="clr-namespace:HunterPie.UI.Architecture.Converters.Brushes"
             xmlns:conditionals="clr-namespace:HunterPie.UI.Architecture.Converters.Conditionals"
             xmlns:converters="clr-namespace:HunterPie.UI.Architecture.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:presentation="clr-namespace:HunterPie.UI.Overlay.Widgets.Damage.Presentation"
             xmlns:system="clr-namespace:System;assembly=System.Runtime"
             xmlns:viewModels="clr-namespace:HunterPie.UI.Overlay.Widgets.Damage.ViewModels"
             xmlns:visibilities="clr-namespace:HunterPie.UI.Architecture.Converters.Visibilities"
             d:DataContext="{d:DesignInstance viewModels:PlayerViewModel}"
             d:DesignHeight="40"
             d:DesignWidth="300"
             mc:Ignorable="d">
	<UserControl.Resources>
		<converters:WeaponToIconConverter x:Key="WeaponToIconConverter" />
		<converters:DoubleFlooringConverter x:Key="DoubleFlooringConverter" />
		<converters:DoubleToDecimalConverter x:Key="DoubleToDecimalConverter" />
		<converters:IntToKFormat x:Key="IntToKFormat" />
		<presentation:PlayerDamageBarGradientBrushConverter x:Key="PlayerDamageBarGradientBrushConverter" />
		<presentation:PlayerDamageBarCompGradientBrushConverter x:Key="PlayerDamageBarCompGradientBrushConverter" />
		<converters:ParentSizePercentageConverter x:Key="ParentSizePercentageConverter" />
		<BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
		<visibilities:BooleansToVisibilityMultiConverter x:Key="BooleansToVisibilityMultiConverter" />
		<visibilities:PartialBooleansToVisibilityConverter x:Key="PartialBooleansToVisibilityConverter" />
		<arithmetics:NumberCapConverter x:Key="NumberCapConverter"
		                                Format="{}{0:N0}"
		                                Maximum="9999" />
		<converters:ConverterPipeline x:Key="IsNotNullConverter">
			<conditionals:IsNullConverter />
			<converters:InvertBooleanConverter />
		</converters:ConverterPipeline>
		<brushes:BrushOpacityConverter x:Key="BrushOpacityConverter" />
		<system:Double x:Key="Internal.Status.Opacity">0.6</system:Double>
	</UserControl.Resources>
	<Border BorderBrush="{StaticResource Gray}"
	        BorderThickness="0,1,0,0">
		<Grid>
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="30" />
				<ColumnDefinition Width="Auto" />
				<ColumnDefinition Width="*" />
				<ColumnDefinition Width="Auto" />
			</Grid.ColumnDefinitions>

			<!--  Contribution Bar  -->
			<Grid Grid.Column="0"
			      Grid.ColumnSpan="4"
			      HorizontalAlignment="Left"
			      Opacity=".25">
				<Grid.Width>
					<MultiBinding Converter="{StaticResource ParentSizePercentageConverter}">
						<Binding Path="ActualWidth"
						         RelativeSource="{RelativeSource AncestorType={x:Type Grid}}" />
						<Binding Path="DataContext.Bar.Percentage"
						         RelativeSource="{RelativeSource Self}" />
					</MultiBinding>
				</Grid.Width>
				<Rectangle Fill="{Binding Bar.Color.Value, Mode=OneWay, Converter={StaticResource PlayerDamageBarCompGradientBrushConverter}}" />
				<Rectangle Fill="{Binding Bar.Color.Value, Mode=OneWay, Converter={StaticResource PlayerDamageBarGradientBrushConverter}}" />
			</Grid>

			<!--  Weapon Icon  -->
			<Image Grid.Column="0"
			       Margin="2,8"
			       d:Source="{StaticResource ICON_BOW}"
			       Source="{Binding Weapon, Mode=OneWay, Converter={StaticResource WeaponToIconConverter}}"
			       Stretch="Uniform" />

			<!--  Status Data  -->
			<Border Grid.Column="1"
			        BorderThickness="1"
			        Margin="0,5"
			        Padding="2"
			        Background="{Binding Source={StaticResource Gray@200}, Converter={StaticResource BrushOpacityConverter}, ConverterParameter={StaticResource Internal.Status.Opacity}}"
			        CornerRadius="5">
				<Border.Style>
					<Style TargetType="Border">
						<Style.Triggers>
							<DataTrigger Binding="{Binding Config.IsStatusEnabled.Value, Mode=OneWay}"
							             Value="True">
								<Setter Property="Visibility">
									<Setter.Value>
										<MultiBinding Converter="{StaticResource PartialBooleansToVisibilityConverter}">
											<Binding Converter="{StaticResource IsNotNullConverter}"
											         Path="RawDamage" />
											<Binding Converter="{StaticResource IsNotNullConverter}"
											         Path="ElementalDamage" />
											<Binding Converter="{StaticResource IsNotNullConverter}"
											         Path="Affinity" />
										</MultiBinding>
									</Setter.Value>
								</Setter>
							</DataTrigger>
							<DataTrigger Binding="{Binding Config.IsStatusEnabled.Value, Mode=OneWay}"
							             Value="False">
								<Setter Property="Visibility" Value="Collapsed" />
							</DataTrigger>
						</Style.Triggers>
					</Style>
				</Border.Style>
				<Grid>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*" />
						<ColumnDefinition Width="*" />
					</Grid.ColumnDefinitions>
					<Viewbox Grid.Column="0"
					         MaxWidth="24"
					         Margin="0,0,5,0"
					         HorizontalAlignment="Center"
					         VerticalAlignment="Center"
					         Stretch="Uniform"
					         StretchDirection="DownOnly">
						<StackPanel Orientation="Vertical">
							<!--  Raw Damage  -->
							<TextBlock HorizontalAlignment="Center"
							           d:Text="98"
							           FontSize="10"
							           Foreground="{StaticResource White}"
							           Text="{Binding RawDamage, Mode=OneWay, Converter={StaticResource NumberCapConverter}, TargetNullValue=0}">
								<TextBlock.Visibility>
									<MultiBinding Converter="{StaticResource BooleansToVisibilityMultiConverter}">
										<Binding Converter="{StaticResource IsNotNullConverter}"
										         Mode="OneWay"
										         Path="RawDamage" />
										<Binding Mode="OneWay"
										         Path="Config.IsRawDamageEnabled.Value" />
									</MultiBinding>
								</TextBlock.Visibility>
							</TextBlock>

							<!--  Elemental Damage  -->
							<TextBlock HorizontalAlignment="Center"
							           d:Text="43"
							           FontSize="10"
							           Foreground="{StaticResource Yellow}"
							           Text="{Binding ElementalDamage, Mode=OneWay, Converter={StaticResource NumberCapConverter}, TargetNullValue=0}">
								<TextBlock.Visibility>
									<MultiBinding Converter="{StaticResource BooleansToVisibilityMultiConverter}">
										<Binding Converter="{StaticResource IsNotNullConverter}"
										         Mode="OneWay"
										         Path="RawDamage" />
										<Binding Mode="OneWay"
										         Path="Config.IsElementalDamageEnabled.Value" />
									</MultiBinding>
								</TextBlock.Visibility>
							</TextBlock>
						</StackPanel>
					</Viewbox>

					<Viewbox Grid.Column="1"
					         MaxWidth="24"
					         HorizontalAlignment="Center"
					         VerticalAlignment="Center">
						<TextBlock d:Text="42%"
						           FontSize="10"
						           Foreground="{StaticResource LightViolet@300}"
						           Text="{Binding Affinity, Mode=OneWay, StringFormat='{}{0}%'}">
							<TextBlock.Visibility>
								<MultiBinding Converter="{StaticResource BooleansToVisibilityMultiConverter}">
									<Binding Converter="{StaticResource IsNotNullConverter}"
									         Mode="OneWay"
									         Path="Affinity" />
									<Binding Mode="OneWay"
									         Path="Config.IsAffinityEnabled.Value" />
								</MultiBinding>
							</TextBlock.Visibility>
						</TextBlock>
					</Viewbox>

				</Grid>
			</Border>

			<!--  Basic Data  -->
			<Grid Grid.Column="2"
			      Margin="0,5">
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
					<RowDefinition Height="*" />
				</Grid.RowDefinitions>
				<TextBlock Grid.Row="0"
				           Foreground="{StaticResource White@50}">
					<Run FontSize="10"
					     FontWeight="SemiBold"
					     Foreground="{StaticResource White@400}"
					     Text="Lv." />
					<Run d:Text="180"
					     FontSize="10"
					     Text="{Binding MasterRank, Mode=OneWay}" />
				</TextBlock>
				<TextBlock Grid.Row="1"
				           VerticalAlignment="Center"
				           d:Text="Player Name"
				           FontFamily="{StaticResource Font.Default}"
				           FontSize="14"
				           Foreground="{StaticResource White@50}"
				           Text="{Binding Name, Mode=OneWay}"
				           TextTrimming="CharacterEllipsis">
					<TextBlock.Style>
						<Style TargetType="TextBlock">
							<Style.Triggers>
								<DataTrigger Binding="{Binding Config.ShouldBlurNames.Value}"
								             Value="True">
									<Setter Property="Effect">
										<Setter.Value>
											<BlurEffect KernelType="Gaussian"
											            Radius="10" />
										</Setter.Value>
									</Setter>
								</DataTrigger>
							</Style.Triggers>
						</Style>
					</TextBlock.Style>
				</TextBlock>
			</Grid>

			<!--  Damage Data  -->
			<Grid Grid.Column="3">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>
				<Grid.RowDefinitions>
					<RowDefinition Height="*" />
					<RowDefinition Height="*" />
				</Grid.RowDefinitions>

				<!--  Contribution  -->
				<TextBlock Grid.Row="0"
				           Grid.RowSpan="2"
				           Grid.Column="0"
				           Margin="0,0,5,0"
				           VerticalAlignment="Center"
				           FontSize="13"
				           FontWeight="Medium"
				           Foreground="{StaticResource White}"
				           TextAlignment="Center">
					<Run d:Foreground="{StaticResource Green}"
					     d:Text="▴">
						<Run.Style>
							<Style TargetType="{x:Type Run}">
								<Setter Property="Text" Value="▾" />
								<Setter Property="Foreground" Value="{StaticResource Red}" />
								<Style.Triggers>
									<DataTrigger Binding="{Binding IsIncreasing, Mode=OneWay}"
									             Value="True">
										<Setter Property="Text" Value="▴" />
										<Setter Property="Foreground" Value="{StaticResource Green}" />
									</DataTrigger>
								</Style.Triggers>
							</Style>
						</Run.Style>
					</Run>
					<Run d:Text="75"
					     Text="{Binding Bar.Percentage, Converter={StaticResource DoubleFlooringConverter}, StringFormat=\{0:F0\}}" /><Run d:Text=".4%"
					     FontSize="11"
					     FontWeight="Normal"
					     Foreground="{StaticResource White@500}"
					     Text="{Binding Bar.Percentage, Converter={StaticResource DoubleToDecimalConverter}, StringFormat=\.\{0:D2\}\%}" />
				</TextBlock>

				<!--  DPS  -->
				<TextBlock Grid.Row="0"
				           Grid.Column="1"
				           Margin="0,0,2,0"
				           HorizontalAlignment="Right"
				           VerticalAlignment="Center"
				           Visibility="{Binding Config.ShouldShowDPS.Value, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
					<Run FontSize="10"
					     FontWeight="SemiBold"
					     Foreground="{StaticResource White@400}"
					     Text="DPS" />
					<Run d:Text="100.0"
					     FontWeight="Medium"
					     Foreground="{StaticResource White@50}"
					     Text="{Binding DPS, Mode=OneWay, StringFormat=\{0:F1\}}" /><Run FontSize="9"
					     Foreground="{StaticResource White@400}"
					     Text="/s" />
				</TextBlock>

				<!--  Total Damage  -->
				<TextBlock Grid.Row="1"
				           Grid.Column="1"
				           Margin="0,0,2,0"
				           HorizontalAlignment="Right"
				           VerticalAlignment="Center"
				           Visibility="{Binding Config.ShouldShowDamage.Value, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
					<Run FontSize="10"
					     FontWeight="SemiBold"
					     Foreground="{StaticResource White@400}"
					     Text="DMG" />
					<Run d:Text="100,000"
					     FontWeight="Medium"
					     Foreground="{StaticResource White@50}"
					     Text="{Binding Damage, Mode=OneWay, StringFormat={}{0:N0}}" />
				</TextBlock>
			</Grid>
			<Grid.Style>
				<Style TargetType="Grid">
					<Style.Triggers>
						<MultiDataTrigger>
							<MultiDataTrigger.Conditions>
								<Condition Binding="{Binding Config.ShouldHighlightMyself.Value, Mode=OneWay}" Value="True" />
								<Condition Binding="{Binding IsUser, Mode=OneWay}" Value="False" />
							</MultiDataTrigger.Conditions>
							<Setter Property="Opacity" Value="0.5" />
						</MultiDataTrigger>
					</Style.Triggers>
				</Style>
			</Grid.Style>
		</Grid>
	</Border>
</UserControl>
